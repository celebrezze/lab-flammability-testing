---
title: "Temperature and Heat Flux Exploration"
author: "Joe Celebrezze"
date: "2023-05-30"
output: html_document
---

Note: a sizable portion of this is copied over from thermocoupler_visualization, but that script was getting messy and convoluted, so I reorganized it and deleted some stuff, added some stuff to make this script

Data cleaning prior to R: 
- Delete first rows of thermocoupler data

# Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# packages
library(tidyverse)
library(here)
library(lubridate) # to handle dates
library(ggfortify)
library(hms) # to handle timestamps
library(caret) # for optimization routine
library(ggridges) # for ridgeline plots

# defining functions
here = here::here

# reading in data
thermocoupler.files <- list.files(here('data', 'raw-data', 'thermocouplers'))
thermocoupler.df.list <- list()
for(i in 1:length(thermocoupler.files)){
  df <- read.csv(here('data', 'raw-data', 'thermocouplers', thermocoupler.files[[i]]))
  thermocoupler.df.list[[i]] <- df
}

flamm.df <- read.csv(here('data', 'processed-data', 'main_dataset.csv'))
```

# Datalogger Data Wrangling
This includes data from the thermocouplers (CH1-6) as well as the heat flux sensors (CH7-8); the datalogger took data every 500 ms
```{r}
# Combining thermocoupler datasheets
thermocoupler.df <- do.call('rbind', thermocoupler.df.list)

# Getting temperature data in correct format
for(i in 4:11){
thermocoupler.df[,i] <- thermocoupler.df[,i] %>% 
  str_replace(pattern = '\\+ ', replacement = ' ') %>% 
  str_trim(side = c('left'))
thermocoupler.df[,i] <- as.numeric(thermocoupler.df[,i])
}
thermocoupler.df <- na.omit(thermocoupler.df)

# Splitting date and time into two columns
thermocoupler.df <- thermocoupler.df %>% 
  mutate(Date.Time = as.POSIXct(Date.Time) + 80) %>%  # Adjusting time so it matches time on clock
  mutate(date = as.Date(Date.Time)) %>% 
  mutate(time = format(as.POSIXct(Date.Time), format = "%H:%M:%S")) %>% 
  mutate(time = as_hms(time))

# For heat flux
heatflux.df <- thermocoupler.df %>% 
  select(date, time, ms, CH1, CH2, CH3, CH4, CH5, CH6, CH7, CH8)
heatflux.df.long <- heatflux.df %>% 
  select(date, time, ms, CH7, CH8) %>% 
  pivot_longer(cols = starts_with("CH"),
               names_to = 'sensor.id',
               values_to = 'heat.flux')

# Removing unncessary columns
thermocoupler.df <- thermocoupler.df %>% 
  select(date, time, ms, CH1, CH2, CH3, CH4, CH5, CH6)

# Lengthening dataframe
thermocoupler.df.long <- thermocoupler.df %>% 
  pivot_longer(cols = starts_with("CH"),
               names_to = 'thermo.id',
               values_to = 'temp')

# Combining dataframes
temp.heat.flux.df <- merge(thermocoupler.df.long, heatflux.df.long, by = c('date', 'time', 'ms'))
temp.heat.flux.df <- temp.heat.flux.df %>% 
  mutate(sensor.location = case_when(
    sensor.id == 'CH7' ~ 'Top',
    sensor.id == 'CH8' ~ 'Left Side'
  ))
```


# Metric Calculations
## Calculating Temp. Metrics
### Maximum Temperature
```{r, warning = F}
flamm.df <- flamm.df %>% 
  mutate(max_temp = NA, time_at_max_temp = NA, max_temp_sensor = NA) %>% 
  mutate(primary_time_of_flame_end = as_hms(primary_time_of_flame_end))
thermocoupler.df.long <- thermocoupler.df.long %>% 
  mutate(max_temp = NA) 
for(i in 1:nrow(flamm.df)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id %in% c('CH1', 'CH2', 'CH5', 'CH6')) %>% # if we want to exclude vent thermocoupler, top glass thermocoupler
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$primary_ignition[i] & time <= flamm.df$primary_time_of_flame_end[i]) #again, index row, select columns
  flamm.df$max_temp[i] <- max(df$temp)
  df$max_temp <- case_when(df$temp == flamm.df$max_temp[i] ~ 'yes')
  df.mt <- df %>% 
    filter(max_temp == 'yes')
  flamm.df$time_at_max_temp[i] <- df.mt$time[1]
  flamm.df$max_temp_sensor[i] <- df.mt$thermo.id[1]
}
flamm.df <- flamm.df %>% 
  mutate(time_at_max_temp = as_hms(time_at_max_temp),
         max_temp = as.numeric(max_temp))

#rm(df, df.mt) # Decluttering environment by removing temporary dataframes from above for loop
```

### Starting Temp. and Temp. Change
```{r, warning = F}
flamm.df <- flamm.df %>% 
  mutate(start_temp = NA, start_temp_sensor = NA) %>% 
  mutate(start_time = as_hms(start_time))
thermocoupler.df.long <- thermocoupler.df.long %>% 
  mutate(start_temp = 'yes')
for(i in 1:nrow(flamm.df)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id %in% c('CH1', 'CH2', 'CH5', 'CH6')) %>% # if we want to exclude vent thermocoupler, top glass thermocoupler
    filter(date == flamm.df$date[i]) %>% 
    filter(time == flamm.df$start_time[i]) %>% 
    filter(ms == 0)
  flamm.df$start_temp[i] <- max(df$temp)
  df$start_temp <- case_when(df$temp == flamm.df$start_temp[i] ~ 'yes')
  df.st <- df %>% 
    filter(start_temp == 'yes')
  flamm.df$start_temp_sensor[i] <- df.st$thermo.id[1]
}
flamm.df <- flamm.df %>% 
  mutate(temp_change = max_temp - start_temp) %>% 
  mutate(temp_change = as.numeric(temp_change),
         start_temp = as.numeric(start_temp))

rm(df) # Decluttering environment by removing temporary dataframe from above for loop

woo <- flamm.df %>% 
  filter(start_temp < 0)
```

### Full Test Average Temp (CH2 and CH6)
```{r}
flamm.df <- flamm.df %>% 
  mutate(start_time = as_hms(start_time),
         end_time = as_hms(end_time)) %>%
  mutate(avg_temp_ch1 = NA, avg_temp_ch2 = NA, avg_temp_ch3 = NA, avg_temp_ch4 = NA, avg_temp_ch5 = NA, avg_temp_ch6 = NA)
for(i in 1:nrow(flamm.df)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id %in% c('CH1', 'CH2', 'CH3', 'CH4', 'CH5', 'CH6')) %>% # if we want to exclude vent thermocoupler, top glass thermocoupler
    pivot_wider(names_from = 'thermo.id', values_from = 'temp') %>% 
    filter(date == flamm.df$date[i]) %>% 
    filter(time > flamm.df$start_time[i] & time < flamm.df$end_time[i]) %>% 
    filter(ms == 0)
  flamm.df$avg_temp_ch1[i] <- mean(df$CH1)
  flamm.df$avg_temp_ch2[i] <- mean(df$CH2)
  flamm.df$avg_temp_ch3[i] <- mean(df$CH3)
  flamm.df$avg_temp_ch4[i] <- mean(df$CH4)
  flamm.df$avg_temp_ch5[i] <- mean(df$CH5)
  flamm.df$avg_temp_ch6[i] <- mean(df$CH6)
}

flamm.df %>% 
  ggplot(aes(x = date, y = avg_temp_ch6)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.1, height = 0.01, alpha = 0.4, aes(color = species)) +
    labs(x = "Date", y = "Avg Temp. (CH6)", color = 'Species') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))

flamm.df %>% 
  ggplot(aes(x = avg_temp_ch6, y = fh)) +
    geom_point() +
    geom_smooth() +
    labs(x = "Avg Temp. (CH6)", y = "Flame Height") +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))

# Proportion Ignited (per day)
flamm.df.prop.ig1 <- flamm.df %>% 
  group_by(date) %>%
  dplyr::summarise(n = n()) %>% 
  ungroup() 
  
flamm.df.prop.ig2 <- flamm.df %>% 
  filter(ignition %in% c('M', '0')) %>% 
  group_by(date) %>% 
  dplyr::summarise(manual_or_nonignitions = n()) %>% 
  select(manual_or_nonignitions)

flamm.df.prop.ig <- cbind(flamm.df.prop.ig1, flamm.df.prop.ig2) %>% 
  mutate(prop_ig_date = (n-manual_or_nonignitions)/n)

rm(flamm.df.prop.ig1, flamm.df.prop.ig2) # Decluttering environment by removing temporary dataframes

flamm.df.prop.ig <- flamm.df.prop.ig %>% 
  select(date, prop_ig_date)
flamm.df.prop.ig <- merge(flamm.df, flamm.df.prop.ig, by = 'date')

flamm.df.prop.ig %>% 
  group_by(date) %>% 
  dplyr::summarise(prop_ig_date = prop_ig_date, avg_temp_ch2 = mean(avg_temp_ch2), avg_temp_ch6 = mean(avg_temp_ch6)) %>% 
  ggplot(aes(x = avg_temp_ch2, y = prop_ig_date)) +
    geom_point() +
    labs(x = "Avg Temp. (CH2)", y = "Proportion Ignited (per day)") +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))
```

### 'Stable' Average Temp. (CH2 and CH6; from 15 seconds after start time to 10 seconds before ignition)
Trying to get an average temp. of the 'stable' period of the test where we see the temperature time series mostly flatten out
```{r}
flamm.df <- flamm.df %>% 
  mutate(avg_stable_temp_ch2 = NA) %>% 
  mutate(avg_stable_temp_ch6 = NA)

flamm.df.ignite <- flamm.df %>% 
  drop_na(primary_ignition) %>% 
  mutate(primary_ignition = as_hms(primary_ignition))

flamm.df.nonignite <- flamm.df %>% 
  filter(is.na(primary_ignition))

for(i in 1:nrow(flamm.df.ignite)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id %in% c('CH2', 'CH6')) %>% # if we want to exclude vent thermocoupler, top glass thermocoupler
    pivot_wider(names_from = 'thermo.id', values_from = 'temp') %>% 
    filter(date == flamm.df.ignite$date[i]) %>% 
    filter(time > as_hms(as.POSIXct(flamm.df.ignite$start_time[i])+15) &
           time < as_hms(as.POSIXct(flamm.df.ignite$primary_ignition[i])-10)) %>% 
    filter(ms == 0)
  flamm.df.ignite$avg_stable_temp_ch2[i] <- mean(df$CH2)
  flamm.df.ignite$avg_stable_temp_ch6[i] <- mean(df$CH6)
}

flamm.df <- rbind(flamm.df.ignite, flamm.df.nonignite)
rm(flamm.df.ignite, flamm.df.nonignite)
```

### 'Stable' Average Temp. (whichever sensor used in the max. temp. calculation; from 15 seconds after start time to 10 seconds before ignition)
Trying to get an average temp. of the 'stable' period of the test where we see the temperature time series mostly flatten out
```{r}
flamm.df <- flamm.df %>% 
  mutate(avg_stable_temp = NA)

flamm.df.ignite <- flamm.df %>% 
  drop_na(primary_ignition) %>% 
  mutate(primary_ignition = as_hms(primary_ignition)) %>% 
  mutate(start_time = as_hms(start_time))

flamm.df.nonignite <- flamm.df %>% 
  filter(is.na(primary_ignition))

for(i in 1:nrow(flamm.df.ignite)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id == flamm.df.ignite$max_temp_sensor[i]) %>% # selecting sensor used to calculate max. temp.
    filter(date == flamm.df.ignite$date[i]) %>% 
    filter(time > as_hms(as.POSIXct(flamm.df.ignite$start_time[i])+15) &
           time < as_hms(as.POSIXct(flamm.df.ignite$primary_ignition[i])-10)) %>% 
    filter(ms == 0)
  flamm.df.ignite$avg_stable_temp[i] <- mean(df$temp)
}

flamm.df <- rbind(flamm.df.ignite, flamm.df.nonignite)
rm(flamm.df.ignite, flamm.df.nonignite)
```


### 1 Second Before Ignition
```{r, warning = F}
flamm.df <- flamm.df %>% 
  mutate(preignition_temp = NA, preignition_temp_sensor = NA)
thermocoupler.df.long <- thermocoupler.df.long %>% 
  mutate(preignition_temp = 'yes')
for(i in 1:nrow(flamm.df)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id %in% c('CH1', 'CH2', 'CH5', 'CH6')) %>% # if we want to exclude vent thermocoupler, top glass thermocoupler
    filter(date == flamm.df$date[i]) %>% 
    filter(time == flamm.df$primary_ignition[i]-1) %>% 
    filter(ms == 0)
  flamm.df$preignition_temp[i] <- max(df$temp)
  df$preignition_temp <- case_when(df$temp == flamm.df$preignition_temp[i] ~ 'yes')
  df.st <- df %>% 
    filter(preignition_temp == 'yes')
  flamm.df$preignition_temp_sensor[i] <- df.st$thermo.id[1]
}

flamm.df <- flamm.df %>% 
  mutate(temp_preignition_deviation = max_temp - preignition_temp)

rm(df, df.st) # Decluttering environment by removing temporary dataframe from above for loop
```


### Other iterations of Max. Temp.
#### Time of fh +/- 2sec
```{r, warning = F}
flamm.df <- flamm.df %>% 
  mutate(max_temp_flameht = NA) %>% 
  mutate(time_at_max_temp_flameht = NA)

flamm.df.ignite <- flamm.df %>% 
  drop_na(time_fh) %>% 
  mutate(time_fh = as_hms(time_fh))

flamm.df.nonignite <- flamm.df %>% 
  filter(is.na(time_fh))

thermocoupler.df.long <- thermocoupler.df.long %>% 
  mutate(max_temp = NA) 
for(i in 1:nrow(flamm.df.ignite)){
  df <- thermocoupler.df.long %>%
    filter(date == flamm.df.ignite$date[i]) %>%  #index row, select column for date
    filter(time >= as_hms(as.POSIXct(flamm.df.ignite$time_fh[i])-2) &
           time <= as_hms(as.POSIXct(flamm.df.ignite$time_fh[i])+2))
  flamm.df.ignite$max_temp_flameht[i] <- max(df$temp)
  df$max_temp <- case_when(df$temp == flamm.df.ignite$max_temp_flameht[i] ~ 'yes')
  df.mt <- df %>% 
    filter(max_temp == 'yes')
  flamm.df.ignite$time_at_max_temp_flameht[i] <- df.mt$time[1]
}
flamm.df.ignite <- flamm.df.ignite %>% 
  mutate(time_at_max_temp_flameht = as_hms(time_at_max_temp_flameht))

flamm.df <- rbind(flamm.df.ignite, flamm.df.nonignite)
rm(flamm.df.ignite, flamm.df.nonignite)
```

#### Full time series
```{r, warning = F}
flamm.df <- flamm.df %>% 
  mutate(max_temp_full_time = NA) %>% 
  mutate(time_at_max_temp_full_time = NA)
thermocoupler.df.long <- thermocoupler.df.long %>% 
  mutate(max_temp = NA) 
for(i in 1:nrow(flamm.df)){
  df <- thermocoupler.df.long %>%
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$start_time & time <= flamm.df$end_time[i])
  flamm.df$max_temp_full_time[i] <- max(df$temp)
  df$max_temp <- case_when(df$temp == flamm.df$max_temp_full_time[i] ~ 'yes')
  df.mt <- df %>% 
    filter(max_temp == 'yes')
  flamm.df$time_at_max_temp_full_time[i] <- df.mt$time[1]
}
flamm.df <- flamm.df %>% 
  mutate(time_at_max_temp_full_time = as_hms(time_at_max_temp_full_time))
```

### Temperature Deviations
Max temp. - Avg. 'stable' temp. (using same sensor)
```{r}
flamm.df <- flamm.df %>% 
  mutate(temp_deviation_one_sensor = max_temp - avg_stable_temp)
```

Max temp. - Avg. 'stable' temp. (taking average of two sensors for each)
```{r, warning = F}
# Calculating max temp (average of two sensors)
flamm.df <- flamm.df %>% 
  mutate(max_temp_2sensor_avg = NA) %>% 
  mutate(time_at_max_temp = as_hms(time_at_max_temp))
thermocoupler.df.long <- thermocoupler.df.long %>% 
  mutate(max_temp = NA) 
for(i in 1:nrow(flamm.df)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id %in% case_when(flamm.df$max_temp_sensor[i] %in% c('CH1', 'CH2') ~ c('CH1', 'CH2'),
                                    flamm.df$max_temp_sensor[i] %in% c('CH5', 'CH6') ~ c('CH5', 'CH6'))) %>% # selecting the pair of thermocouples corresponding with the thermocouple used in the max. temp. calculation
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time == flamm.df$time_at_max_temp[i]) %>% 
    filter(ms == 0)
  flamm.df$max_temp_2sensor_avg[i] <- mean(df$temp)
}
flamm.df <- flamm.df %>% 
  mutate(max_temp_2sensor_avg = as.numeric(max_temp_2sensor_avg))

# Calculating stable avg temp. (average of two sensors)
flamm.df <- flamm.df %>% 
  mutate(avg_stable_temp_2sensor_avg = NA)

flamm.df.ignite <- flamm.df %>% 
  drop_na(primary_ignition) %>% 
  mutate(primary_ignition = as_hms(primary_ignition)) %>% 
  mutate(start_time = as_hms(start_time))

flamm.df.nonignite <- flamm.df %>% 
  filter(is.na(primary_ignition))

for(i in 1:nrow(flamm.df.ignite)){
  df <- thermocoupler.df.long %>% 
    filter(thermo.id %in% case_when(flamm.df$max_temp_sensor[i] %in% c('CH1', 'CH2') ~ c('CH1', 'CH2'),
                                    flamm.df$max_temp_sensor[i] %in% c('CH5', 'CH6') ~ c('CH5', 'CH6'))) %>% # selecting the pair of thermocouples corresponding with the thermocouple used in the max. temp. calculation
    filter(date == flamm.df.ignite$date[i]) %>% 
    filter(time > as_hms(as.POSIXct(flamm.df.ignite$start_time[i])+15) &
           time < as_hms(as.POSIXct(flamm.df.ignite$primary_ignition[i])-10)) %>% 
    filter(ms == 0)
  flamm.df.ignite$avg_stable_temp_2sensor_avg[i] <- mean(df$temp)
}

flamm.df <- rbind(flamm.df.ignite, flamm.df.nonignite)
rm(flamm.df.ignite, flamm.df.nonignite, df)

flamm.df <- flamm.df %>% 
  mutate(temp_deviation_two_sensors = max_temp_2sensor_avg - avg_stable_temp_2sensor_avg)
```

#### Plot
```{r}
temp_labels <- c('Temp. Dev. (One Sensor)', 'Temp. Dev. (Two Sensors)', 'Temp. Change')
names(temp_labels) <- c('temp_deviation_one_sensor', 'temp_deviation_two_sensors', 'temp_change')

flamm.df %>% 
  filter(temp_deviation_one_sensor < 100) %>%  # removing outlier
  select(fd, fh, species, temp_deviation_one_sensor, temp_deviation_two_sensors, temp_change) %>% 
  pivot_longer(cols = c(temp_deviation_one_sensor, temp_deviation_two_sensors, temp_change), names_to = 'temp_var', values_to = 'temp_vals') %>% 
  rename(`Flame Duration` = fd, `Flame Height` = fh) %>% 
  pivot_longer(cols = c(`Flame Duration`, `Flame Height`), names_to = 'flam_var', values_to = 'flam_vals') %>% 
  ggplot(aes(x = flam_vals, y = temp_vals, color = species)) +
    geom_point() +
    geom_smooth(method = 'lm', se = F) +
    facet_grid(temp_var ~ flam_var, scales = 'free', labeller = labeller(temp_var = temp_labels)) +    
    labs(x = 'Flammability Metric', y = 'Temperature Variable', color = 'Species') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))

flamm.df %>% 
  filter(temp_deviation_one_sensor < 100) %>%  # removing outlier
  select(fd, fh, species, temp_deviation_one_sensor, temp_deviation_two_sensors, temp_change) %>% 
  pivot_longer(cols = c(temp_deviation_one_sensor, temp_deviation_two_sensors, temp_change), names_to = 'temp_var', values_to = 'temp_vals') %>% 
  rename(`Flame Duration` = fd, `Flame Height` = fh) %>% 
  pivot_longer(cols = c(`Flame Duration`, `Flame Height`), names_to = 'flam_var', values_to = 'flam_vals') %>% 
  ggplot(aes(x = flam_vals, y = temp_vals)) +
    geom_point() +
    geom_smooth(color = 'gray30') +
    facet_grid(temp_var ~ flam_var, scales = 'free', labeller = labeller(temp_var = temp_labels)) +    
    labs(x = 'Flammability Metric', y = 'Temperature Variable') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))
```

## Heat Flux
### Max. Heat Flux
Still deciding on what to use here... top sensor, side sensor, avg of both?
#### Raw data
```{r, warning = F}
flamm.df <- flamm.df %>% 
  mutate(max_heat_flux = NA) %>% 
  mutate(time_at_max_heat_flux = NA)
temp.heat.flux.df <- temp.heat.flux.df %>% 
  mutate(max_heat_flux = NA) 
for(i in 1:nrow(flamm.df)){
  df <- temp.heat.flux.df %>% 
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$start_time[i] & time <= flamm.df$end_time[i]) #again, index row, select columns
  flamm.df$max_heat_flux[i] <- max(df$heat.flux)
  df$max_heat_flux <- case_when(df$heat.flux == flamm.df$max_heat_flux[i] ~ 'yes')
  df.mhf <- df %>% 
    filter(max_heat_flux == 'yes')
  flamm.df$time_at_max_heat_flux[i] <- df.mhf$time[1]
}
flamm.df <- flamm.df %>% 
  mutate(time_at_max_heat_flux = as_hms(time_at_max_heat_flux))

rm(df, df.mhf) # Decluttering environment by removing temporary dataframes from above for loop
```

#### Loess regressions
```{r}
flamm.df <- flamm.df %>% 
  mutate(max_heat_flux_loessCH7 = NA) %>% 
  mutate(time_at_max_heat_flux_loessCH7 = NA) %>% 
  mutate(max_heat_flux_loessCH8 = NA) %>% 
  mutate(time_at_max_heat_flux_loessCH8 = NA)
heatflux.df <- heatflux.df %>% 
  mutate(max_heat_flux_loessCH7 = NA)  %>% 
  mutate(max_heat_flux_loessCH8 = NA)
# NOTE: THIS PART WILL NOT BE NECESSARY WHEN ALL DATALOGGER DATA IS INPUTTED
flamm.df.no.Inf <- flamm.df %>% 
  filter(max_heat_flux > 0)
flamm.df.Inf <- flamm.df %>% 
  filter(max_heat_flux < 0) 

for(i in 1:nrow(flamm.df.no.Inf)){
  df <- heatflux.df %>% 
    filter(date == flamm.df.no.Inf$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df.no.Inf$start_time[i] & time <= flamm.df.no.Inf$end_time[i]) %>% #again, index row, select columns
    mutate(time = as.numeric(time))
  
# Loess regressions
  loess.mod.CH7 <- loess(CH7 ~ time, data = df, span = 0.09826087)
  df$loess.CH7 <- predict(loess.mod.CH7)
  loess.mod.CH8 <- loess(CH8 ~ time, data = df, span = 0.02608696)
  df$loess.CH8 <- predict(loess.mod.CH8)

  flamm.df.no.Inf$max_heat_flux_loessCH7[i] <- max(df$loess.CH7)
  flamm.df.no.Inf$max_heat_flux_loessCH8[i] <- max(df$loess.CH8)
  
  df$max_heat_flux_loessCH7 <- case_when(df$loess.CH7 == flamm.df.no.Inf$max_heat_flux_loessCH7[i] ~ 'yes')
  df$max_heat_flux_loessCH8 <- case_when(df$loess.CH8 == flamm.df.no.Inf$max_heat_flux_loessCH8[i] ~ 'yes')
  
  df.mhf_CH7 <- df %>% 
    filter(max_heat_flux_loessCH7 == 'yes')
  flamm.df.no.Inf$time_at_max_heat_flux_loessCH7[i] <- df.mhf_CH7$time[1]
  df.mhf_CH8 <- df %>% 
    filter(max_heat_flux_loessCH8 == 'yes')
  flamm.df.no.Inf$time_at_max_heat_flux_loessCH8[i] <- df.mhf_CH8$time[1]
}
flamm.df.no.Inf <- flamm.df.no.Inf %>% 
  mutate(time_at_max_heat_flux_loessCH7 = as_hms(time_at_max_heat_flux_loessCH7)) %>% 
  mutate(time_at_max_heat_flux_loessCH8 = as_hms(time_at_max_heat_flux_loessCH8))

flamm.df <- rbind(flamm.df.no.Inf, flamm.df.Inf)

rm(df, df.mhf_CH7, df.mhf_CH8) # Decluttering environment by removing temporary dataframes from above for loop
```

### Average Heat Flux 
#### During Flaming Combustion
```{r}
flamm.df <- flamm.df %>% 
  mutate(avg_heat_flux_fd = NA)

for(i in 1:nrow(flamm.df)){
  df <- temp.heat.flux.df %>% 
    filter(sensor.id == 'CH8') %>% # looking at side sensor only (less noise)
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$primary_ignition[i] & time <= flamm.df$primary_time_of_flame_end[i]) %>% 
    summarise(avg_heat_flux_fd = mean(heat.flux))
  flamm.df$avg_heat_flux_fd[i] <- df$avg_heat_flux_fd
}
rm(df) # Decluttering environment by removing temporary dataframe from above for loop
```

#### Full Test
```{r}
flamm.df <- flamm.df %>% 
  mutate(avg_heat_flux_full_test = NA)

for(i in 1:nrow(flamm.df)){
  df <- temp.heat.flux.df %>% 
    filter(sensor.id == 'CH8') %>% # looking at side sensor only (less noise)
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$start_time[i] & time <= flamm.df$end_time[i]) %>% 
    summarise(avg_heat_flux_full_test = mean(heat.flux))
  flamm.df$avg_heat_flux_full_test[i] <- df$avg_heat_flux_full_test
}
rm(df) # Decluttering environment by removing temporary dataframe from above for loop
```

#### 'Stable' period
```{r}
flamm.df <- flamm.df %>% 
  mutate(avg_heat_flux_stableCH7 = NA) %>% 
  mutate(avg_heat_flux_stableCH8 = NA)

flamm.df.ignite <- flamm.df %>% 
  drop_na(primary_ignition) %>% 
  mutate(primary_ignition = as_hms(primary_ignition))

flamm.df.nonignite <- flamm.df %>% 
  filter(is.na(primary_ignition))

for(i in 1:nrow(flamm.df.ignite)){
  dfCH7 <- temp.heat.flux.df %>% 
    filter(sensor.id == 'CH7') %>% # looking at side sensor only (less noise)
    filter(date == flamm.df.ignite$date[i]) %>%  #index row, select column for date
    filter(time > as_hms(as.POSIXct(flamm.df.ignite$start_time[i])+15) &
           time < as_hms(as.POSIXct(flamm.df.ignite$primary_ignition[i])-10)) %>% 
    summarise(avg_heat_flux_stableCH7 = mean(heat.flux))
    flamm.df.ignite$avg_heat_flux_stableCH7[i] <- dfCH7$avg_heat_flux_stableCH7
  
  dfCH8 <- temp.heat.flux.df %>% 
    filter(sensor.id == 'CH8') %>% # looking at side sensor only (less noise)
    filter(date == flamm.df.ignite$date[i]) %>%  #index row, select column for date
    filter(time > as_hms(as.POSIXct(flamm.df.ignite$start_time[i])+15) &
           time < as_hms(as.POSIXct(flamm.df.ignite$primary_ignition[i])-10)) %>% 
    summarise(avg_heat_flux_stableCH8 = mean(heat.flux))
    flamm.df.ignite$avg_heat_flux_stableCH8[i] <- dfCH8$avg_heat_flux_stableCH8
}

flamm.df <- rbind(flamm.df.ignite, flamm.df.nonignite)

rm(flamm.df.ignite, flamm.df.nonignite, dfCH7, dfCH8) # Decluttering environment by removing temporary dataframe from above for loop
```

### 1 Second Before Ignition (Loess)
```{r}
flamm.df <- flamm.df %>% 
  mutate(preignition_heat_flux_loessCH7 = NA) %>% 
  mutate(preignition_heat_flux_loessCH8 = NA)
heatflux.df <- heatflux.df %>% 
  mutate(preignition_heat_flux_loessCH7 = NA)  %>% 
  mutate(preignition_heat_flux_loessCH8 = NA)
# NOTE: THIS PART WILL NOT BE NECESSARY WHEN ALL DATALOGGER DATA IS INPUTTED
flamm.df.no.Inf <- flamm.df %>% 
  filter(max_heat_flux > 0)
flamm.df.Inf <- flamm.df %>% 
  filter(max_heat_flux < 0) 

for(i in 1:nrow(flamm.df.no.Inf)){
  df <- heatflux.df %>% 
    filter(date == flamm.df.no.Inf$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df.no.Inf$start_time[i] & time <= flamm.df.no.Inf$end_time[i]) %>% #again, index row, select columns
    mutate(time = as.numeric(time))
  
# Loess regressions
  loess.mod.CH7 <- loess(CH7 ~ time, data = df, span = 0.09826087)
  df$loess.CH7 <- predict(loess.mod.CH7)
  loess.mod.CH8 <- loess(CH8 ~ time, data = df, span = 0.02608696)
  df$loess.CH8 <- predict(loess.mod.CH8)

# Filtering out only 1 second preignition
  df2 <- df %>% 
    filter(time == flamm.df.no.Inf$primary_ignition[i] - 1 & ms == 0) 
  
  flamm.df.no.Inf$preignition_heat_flux_loessCH7[i] <- df2$loess.CH7[1]
  flamm.df.no.Inf$preignition_heat_flux_loessCH8[i] <- df2$loess.CH8[1]
}

flamm.df <- rbind(flamm.df.no.Inf, flamm.df.Inf)

rm(df, df2) # Decluttering environment by removing temporary dataframes from above for loop

# Max heat flux (loess) - preignition heat flux
flamm.df <- flamm.df %>% 
  mutate(heatflux_preignition_deviationCH7 = max_heat_flux_loessCH7 - preignition_heat_flux_loessCH7,
         heatflux_preignition_deviationCH8 = max_heat_flux_loessCH8 - preignition_heat_flux_loessCH8)
```


### Deviation From 'Stable' Average
Using Loess-regression-calculated maximum heat flux
```{r}
flamm.df <- flamm.df %>% 
  mutate(heat_flux_deviationCH7 = max_heat_flux_loessCH7 - avg_heat_flux_stableCH7,
         heat_flux_deviationCH8 = max_heat_flux_loessCH8 - avg_heat_flux_stableCH8)
```

### 95% percentile of Heat Flux
```{r}
flamm.df <- flamm.df %>% 
  mutate(heat_flux_95perc = NA) %>% 
  mutate(time_at_heat_flux_95perc = NA)
temp.heat.flux.df <- temp.heat.flux.df %>% 
  mutate(heat_flux_95perc = NA) 
for(i in 1:nrow(flamm.df)){
  df <- temp.heat.flux.df %>% 
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$start_time[i] & time <= flamm.df$end_time[i]) #again, index row, select columns
  flamm.df$heat_flux_95perc[i] <- quantile(df$heat.flux, 0.95)
  df$heat_flux_95perc <- case_when(df$heat.flux == flamm.df$heat_flux_95perc[i] ~ 'yes')
  df.mhf <- df %>% 
    filter(heat_flux_95perc == 'yes')
  flamm.df$time_at_heat_flux_95perc[i] <- df.mhf$time[1]
}
flamm.df <- flamm.df %>% 
  mutate(time_at_heat_flux_95perc = as_hms(time_at_heat_flux_95perc))

rm(df, df.mhf) # Decluttering environment by removing temporary dataframes from above for loop
```

# Visualizations
Bugs in the following code that need to be worked out...

## Heat Flux Visualization Function
```{r}
heatflux.vis <- function(index){
heatflux.df.woop <- heatflux.df %>% 
  filter(date == flamm.df.no.Inf$date[index]) %>%  #index row, select column for date
  filter(time >= flamm.df.no.Inf$start_time[index] & time <= flamm.df.no.Inf$time_of_glow_end[index]) %>% 
  mutate(time = as.numeric(time))

loess.mod.CH7 <- loess(CH7 ~ as.numeric(time), data = heatflux.df.woop, span = 0.0983)
heatflux.df.woop$loess.CH7 <- predict(loess.mod.CH7)

ch7.title <- paste('Top Sensor (span = 0.0983)', flamm.df.no.Inf$species[index], flamm.df.no.Inf$plant[index], flamm.df.no.Inf$rep[index], 'ignition =', flamm.df.no.Inf$ignition[index])

plot.top <- ggplot(heatflux.df.woop, aes(x = time)) +
  geom_point(aes(y = loess.CH7), color = 'black') +
  geom_point(aes(y = CH7), color = 'blue', alpha = 0.2) +
  geom_vline(xintercept = flamm.df.no.Inf$primary_ignition[index], linetype = 4) +
  annotate('text', label = 'Primary Ignition', x = flamm.df.no.Inf$primary_ignition[index], y = 0.95, fontface = 'bold') +
  geom_vline(xintercept = flamm.df.no.Inf$time_at_max_heat_flux_loessCH7[index], linetype = 5) +
  annotate('text', label = 'Max Heat Flux', x = flamm.df.no.Inf$time_at_max_heat_flux_loessCH7[index], y = 1, fontface = 'bold') +
  labs(x = 'Time', y = 'Heat Flux (Top Sensor)', title = ch7.title) +
  theme_bw() + 
  theme(axis.title = element_text(face = 'bold', size = 14),
        axis.text = element_text(size = 12))

loess.mod.CH8 <- loess(CH8 ~ as.numeric(time), data = heatflux.df.woop, span = 0.0261)
heatflux.df.woop$loess.CH8 <- predict(loess.mod.CH8)

ch8.title <- paste('Side Sensor (span = 0.0261)', flamm.df.no.Inf$species[index], flamm.df.no.Inf$plant[index], flamm.df.no.Inf$rep[index], 'ignition =', flamm.df.no.Inf$ignition[index])

plot.side <- ggplot(heatflux.df.woop, aes(x = time)) +
  geom_point(aes(y = loess.CH8), color = 'black') +
  geom_point(aes(y = CH8), color = 'blue', alpha = 0.2) +
  geom_vline(xintercept = flamm.df.no.Inf$primary_ignition[index], linetype = 4) +
  annotate('text', label = 'Primary Ignition', x = flamm.df.no.Inf$primary_ignition[index], y = 0.5, fontface = 'bold') +
  geom_vline(xintercept = flamm.df.no.Inf$time_at_max_heat_flux_loessCH8[index], linetype = 5) +
  annotate('text', label = 'Max Heat Flux', x = flamm.df.no.Inf$time_at_max_heat_flux_loessCH8[index], y = 0.55, fontface = 'bold') +
  labs(x = 'Time', y = 'Heat Flux (Side Sensor)', title = ch8.title) +
  theme_bw() +  
  theme(axis.title = element_text(face = 'bold', size = 14),
        axis.text = element_text(size = 12))
print(plot.side)
print(plot.top)
}
```

## Temperature Time Series
```{r}
plot.list <- list()
for(i in 1:nrow(flamm.df)){
  plot.id <- paste0('thermocoupler_vis_', flamm.df$species[i], '_', flamm.df$plant[i], '_', flamm.df$rep[i])
  title.id <- paste0(flamm.df$species[i], '_', flamm.df$plant[i], '_', flamm.df$rep[i],  '_ignition=', flamm.df$ignition[i])
  df <- thermocoupler.df.long %>% 
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$start_time[i] & time <= flamm.df$time_of_glow_end[i]) #again, index row, select columns for start time and end time
  plot <- ggplot(data = df, aes(x = time, y = temp, color = thermo.id)) +
    geom_point(size = 1) +
    # max flame height
    geom_vline(xintercept = flamm.df$time_fh[i], linewidth = 1, alpha = 0.4) + #index row, select column for time for max flame height
    annotate('text', label = 'Max. Flame Height', x = flamm.df$time_fh[i], y = 255, fontface = 'bold') +
    # max temp
    geom_vline(xintercept = flamm.df$time_at_max_temp[i], linewidth = 1, alpha = 0.4) + #index row, select column for time for max temp
    annotate('text', label = 'Max. Temp.', x = flamm.df$time_at_max_temp[i], y = 245, fontface = 'bold') +
    theme_bw() +
    labs(x = "Time", y = "Temperature (C)", color = "Thermocoupler ID", title = title.id) +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
  #assign(x = plot.id, value = plot)
  plot.list[[i]] <- plot
}
```

HETARB outlier
```{r}
df <- thermocoupler.df %>% 
    filter(date == '2022-08-31')
df <- df[5233:8000,]

plot <- ggplot(data = df, aes(x = time, y = CH1)) +
    geom_point(size = 1) +
    theme_bw() +
    labs(x = "Time", y = "Temperature (C)") +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
plot
```


HETARB shows very low temperatures for 4/6 thermocouples. What is going on?
```{r}
thermocoupler.df.long %>% 
    ggplot(aes(x = time, y = temp, color = thermo.id)) +
      geom_point(size = 0.4) +
      theme_bw() +
      labs(x = "Time", y = "Temperature (C)", color = "Thermocoupler ID",
           title = "Differences Between Dates") +
      facet_wrap(~date, ncol = 1) +
      theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
```

## Heat Flux Time Series
```{r}
plot.list <- list()
for(i in 1:nrow(flamm.df)){
  plot.id <- paste0('heatflux_vis_', flamm.df$species[i], '_', flamm.df$plant[i], '_', flamm.df$rep[i])
  title.id <- paste0(flamm.df$species[i], '_', flamm.df$plant[i], '_', flamm.df$rep[i], '_ignition.type:', flamm.df$ignition[i])
  
  df <- temp.heat.flux.df %>% 
    filter(date == flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= flamm.df$start_time[i] & time <= flamm.df$time_of_glow_end[i]) #again, index row, select columns for start time and end time
  plot <- ggplot(data = df, aes(x = time, y = heat.flux, color = sensor.location)) +
    geom_point(size = 1) +
    # max flame height
    geom_vline(xintercept = flamm.df$time_fh[i], linewidth = 1, alpha = 0.4) + #index row, select column for time for max flame height
    annotate('text', label = 'Max. Flame Height', x = flamm.df$time_fh[i], y = 1.4, fontface = 'bold') +
    # max temp
    geom_vline(xintercept = flamm.df$time_at_max_temp[i], linewidth = 1, alpha = 0.4) + #index row, select column for time for max temp
    annotate('text', label = 'Max. Temp.', x = flamm.df$time_at_max_temp[i], y = 1.3, fontface = 'bold') +
    geom_vline(xintercept = flamm.df$time_at_max_heat_flux[i], linewidth = 1, alpha = 0.4) +    
    annotate('text', label = 'Max. Heat Flux', x = flamm.df$time_at_max_heat_flux[i], y = 1.5, fontface = 'bold') +
    theme_bw() +
    labs(x = "Time", y = "Heat Flux", color = "Sensor Location", title = title.id) +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
  #assign(x = plot.id, value = plot)
  plot.list[[i]] <- plot
}
```

Plots
```{r}
plot.list[[1]]
plot.list[[4]]
plot.list[[7]]
plot.list[[16]]
plot.list[[20]]
plot.list[[47]]
plot.list[[69]]
plot.list[[71]]
plot.list[[73]]
plot.list[[99]]
```

## Temp and Heat Flux
Investigating differences between manual ignitions and natural ignitions
```{r}
plot.list <- list()
sample.subset <- c(4, 5, 11, 32, 59, 1, 8, 16, 7, 24)
sample.subset.ig <- c(rep(1, 5), rep('M', 5))
for(i in sample.subset){
df <- temp.heat.flux.df %>% 
  filter(date == flamm.df$date[i]) %>%  #index row, select column for date
  filter(time >= flamm.df$start_time[i] & time <= flamm.df$time_of_glow_end[i])

title.id <- paste0(flamm.df$species[i], '_', flamm.df$plant[i], '_', flamm.df$rep[i], '_ignition.type:', flamm.df$ignition[i])

plot <- ggplot(data = df, aes(x = time, y = temp)) +    
    geom_point(size = 0.6, aes(y = temp, color = thermo.id)) +
    geom_point(size = 1, alpha = 0.3, aes(y = heat.flux*100, color = sensor.id)) +
    scale_y_continuous(sec.axis = sec_axis(~.*.01, name="Heat Flux")) +
    # max flame height
    scale_color_manual(values = c('#02C3BD', '#00B9AE', '#009F93', '#037171',  '#03312E', 'black', '#D6A184', '#A63D40')) +
    geom_vline(xintercept = flamm.df$time_fh[i], linewidth = 1, alpha = 0.4) + 
    annotate('text', label = 'M.FH', x = flamm.df$time_fh[i], y = 255, fontface = 'bold') +
    # max temp
    geom_vline(xintercept = flamm.df$time_at_max_temp[i], linewidth = 1, alpha = 0.4) +
    annotate('text', label = 'M.Temp.', x = flamm.df$time_at_max_temp[i], y = 245, fontface = 'bold') +
    geom_vline(xintercept = flamm.df$time_at_max_heat_flux[i], linewidth = 1, alpha = 0.4) +    
    annotate('text', label = 'M. Heat Flux', x = flamm.df$time_at_max_heat_flux[i], y = 237, fontface = 'bold') +
    theme_bw() +
    labs(x = "Time", y = "Temperature", color = " ", title = title.id) +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
  plot.list[[i]] <- plot
}
```

```{r}
# Natural ignitions (ignition = 1)
plot.list[[4]]
plot.list[[5]]
plot.list[[11]]
plot.list[[32]]
plot.list[[59]]

# Manual ignitions (ignition = M)
plot.list[[1]]
plot.list[[7]]
plot.list[[8]]
plot.list[[16]]
plot.list[[24]]
```

## August 24 Heat Flux, Temp. Time Series
```{r}
temp.heat.flux.df %>% 
  filter(date == '2022-08-24') %>% 
  ggplot(aes(x = time, y = temp, color = thermo.id)) +
    geom_point(size = 1) +
    theme_bw() +
    labs(x = "Time", y = "Temperature (C)", color = "Thermocoupler ID", title = "August 24 Time Series") +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))

temp.heat.flux.df %>% 
  filter(date == '2022-08-16') %>% 
  ggplot(aes(x = time, y = temp, color = thermo.id)) +
    geom_point(size = 1) +
    theme_bw() +
    labs(x = "Time", y = "Temperature (C)", color = "Thermocoupler ID", title = "August 16 Time Series") +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
```

```{r}
plot.list <- list()
for(i in 1:nrow(aug24.flamm.df)){
  plot.id <- paste0('thermocoupler_vis_', aug24.flamm.df$species[i], '_', aug24.flamm.df$plant[i], '_', aug24.flamm.df$rep[i])
  title.id <- paste0(aug24.flamm.df$species[i], '_', aug24.flamm.df$plant[i], '_', aug24.flamm.df$rep[i],  '_ignition=', aug24.flamm.df$ignition[i])
  df <- thermocoupler.df.long %>% 
    filter(date == aug24.flamm.df$date[i]) %>%  #index row, select column for date
    filter(time >= aug24.flamm.df$start_time[i] & time <= aug24.flamm.df$time_of_glow_end[i]) #again, index row, select columns for start time and end time
  plot <- ggplot(data = df, aes(x = time, y = temp, color = thermo.id)) +
    geom_point(size = 1) +
    # max flame height
    geom_vline(xintercept = aug24.flamm.df$time_fh[i], linewidth = 1, alpha = 0.4) + #index row, select column for time for max flame height
    annotate('text', label = 'Max. Flame Height', x = aug24.flamm.df$time_fh[i], y = 255, fontface = 'bold') +
    # max temp
    geom_vline(xintercept = aug24.flamm.df$time_at_max_temp[i], linewidth = 1, alpha = 0.4) + #index row, select column for time for max temp
    annotate('text', label = 'Max. Temp.', x = aug24.flamm.df$time_at_max_temp[i], y = 245, fontface = 'bold') +
    theme_bw() +
    labs(x = "Time", y = "Temperature (C)", color = "Thermocoupler ID", title = title.id) +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
  #assign(x = plot.id, value = plot)
  plot.list[[i]] <- plot
}
```


```{r}
df <- thermocoupler.df.long %>% 
    filter(date == aug24.flamm.df$date[1]) %>%  #index row, select column for date
    filter(time >= aug24.flamm.df$start_time[2] & time <= aug24.flamm.df$time_of_glow_end[18])

plot <- ggplot(data = df, aes(x = time, y = temp, color = thermo.id)) +
    geom_point(size = 1) +
    theme_bw() +
    labs(x = "Time", y = "Temperature (C)", color = "Thermocoupler ID") +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_blank(),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
plot
```

## Temperature Readings By Day
```{r}
# Boxplots
flamm.df %>% 
  ggplot(aes(x = date, y = avg_temp_ch2)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.2, aes(color = species), alpha = 0.4) +
    theme_bw() +
    labs(x = "Date", y = "Avg. Temp. (CH2)", color = "Species") +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.x = element_text(size = 12, angle = 20),
          axis.text.y = element_text(size = 12),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))

flamm.df %>% 
  ggplot(aes(x = date, y = avg_temp_ch6)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.2, aes(color = species), alpha = 0.4) +
    theme_bw() +
    labs(x = "Date", y = "Avg. Temp. (CH6)", color = "Species") +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.x = element_text(size = 12, angle = 20),
          axis.text.y = element_text(size = 12),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))

# Density plots
flamm.df.noNA <- flamm.df %>% 
  drop_na(avg_temp_ch2)

flamm.df %>% 
  ggplot(aes(x = avg_temp_ch2)) +
    geom_density(fill = 'gray', alpha = 0.4) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch2, 0.05))) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch2, 0.95))) +
    theme_bw() +
    labs(x = "Avg. Temp. (CH2)", y = 'Density') +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.x = element_text(size = 12, angle = 20),
          axis.text.y = element_text(size = 12),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))

flamm.df %>% 
  ggplot(aes(x = avg_temp_ch6)) +
    geom_density(fill = 'gray', alpha = 0.4) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch6, 0.05))) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch6, 0.95))) +
    theme_bw() +
    labs(x = "Avg. Temp. (CH6)", y = 'Density') +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.x = element_text(size = 12, angle = 20),
          axis.text.y = element_text(size = 12),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))

flamm.df %>% 
  ggplot(aes(x = avg_temp_ch3)) +
    geom_density(fill = 'gray', alpha = 0.4) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch3, 0.05))) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch3, 0.95))) +
    theme_bw() +
    labs(x = "Avg. Temp. (Top Vent)", y = 'Density') +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.x = element_text(size = 12, angle = 20),
          axis.text.y = element_text(size = 12),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))

flamm.df %>% 
  ggplot(aes(x = avg_temp_ch4)) +
    geom_density(fill = 'gray', alpha = 0.4) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch4, 0.05))) +
    geom_vline(aes(xintercept = quantile(flamm.df.noNA$avg_temp_ch4, 0.95))) +
    theme_bw() +
    labs(x = "Avg. Temp. (Top Glass)", y = 'Density') +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.x = element_text(size = 12, angle = 20),
          axis.text.y = element_text(size = 12),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))

# Ridgeline plots
flamm.df %>% 
  filter(avg_temp_ch1 > 0) %>% 
  ggplot(aes(x = avg_temp_ch1, y = date, fill = date)) +
  geom_density_ridges() +
  theme_ridges() + 
  labs(x = 'Average Temp (CH1)', y = 'Date') +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

flamm.df %>% 
  filter(avg_temp_ch2 > 0) %>% 
  ggplot(aes(x = avg_temp_ch2, y = date, fill = date)) +
  geom_density_ridges() +
  theme_ridges() + 
  labs(x = 'Average Temp (CH2)', y = 'Date') +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

flamm.df %>% 
  filter(avg_temp_ch3 > 0) %>% 
  ggplot(aes(x = avg_temp_ch3, y = date, fill = date)) +
  geom_density_ridges() +
  theme_ridges() + 
  labs(x = 'Average Temp (Top Vent)', y = 'Date') +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

flamm.df %>% 
  filter(avg_temp_ch4 > 0) %>% 
  ggplot(aes(x = avg_temp_ch4, y = date, fill = date)) +
  geom_density_ridges() +
  theme_ridges() + 
  labs(x = 'Average Temp (Top Front Glass)', y = 'Date') +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

flamm.df %>% 
  filter(avg_temp_ch5 > 0) %>% 
  ggplot(aes(x = avg_temp_ch5, y = date, fill = date)) +
  geom_density_ridges() +
  theme_ridges() + 
  labs(x = 'Average Temp (CH5)', y = 'Date') +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

flamm.df %>% 
  filter(avg_temp_ch6 > 0) %>% 
  ggplot(aes(x = avg_temp_ch6, y = date, fill = date)) +
  geom_density_ridges() +
  theme_ridges() + 
  labs(x = 'Average Temp (CH6)', y = 'Date') +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

flamm.df %>% 
  filter(avg_temp_ch2 > 0) %>% 
  select(avg_temp_ch2, avg_temp_ch6, date) %>% 
  dplyr::rename(CH2 = avg_temp_ch2, CH6 = avg_temp_ch6) %>% 
  pivot_longer(cols = !c(date), names_to = 'sensor', values_to = 'avg_temp') %>% 
  ggplot(aes(x = avg_temp, y = date, fill = sensor)) +
    geom_density_ridges() +
    theme_ridges() + 
    labs(x = 'Average Temp', y = 'Date', fill = 'Sensor') +
    theme(axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

# Avg. temp. vs. FD/FH
flamm.df %>% 
  ggplot(aes(x = avg_temp_ch6, y = fd, color = species)) +
    geom_point(alpha = 0.5) +
    geom_smooth() +
    theme_bw() +
    labs(x = 'Average Temp (CH6)', y = 'Flame Duration', color = "Species") +
    theme(axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))

flamm.df %>% 
  ggplot(aes(x = avg_temp_ch6, y = fh, color = species)) +
    geom_point(alpha = 0.5) +
    geom_smooth() +
    theme_bw() +
    labs(x = 'Average Temp (CH6)', y = 'Flame Height', color = "Species") +
    theme(axis.title = element_text(face = 'bold', size = 14),
        axis.text.x = element_text(size = 12, angle = 20),
        axis.text.y = element_text(size = 12),
        legend.title = element_text(face = 'bold', size = 14),
        legend.text = element_text(size = 12))
```

## Temperature Threshold
We decided that using CH3 (top vent) would make the most sense based on the above density plots and ridgeline plots. The below code looks at how many samples (and what species) would be eliminated by cutting it off at the 1st, 5th and 10th percentiles
```{r}
# 10th percentile
quantile(flamm.df.noNA$avg_temp_ch3, 0.1)
flamm.df %>%
  filter(avg_temp_ch3 < 208.9253) %>% 
  group_by(species) %>% 
  tally()

# 7.5th percentile
quantile(flamm.df.noNA$avg_temp_ch3, 0.075)
flamm.df %>%
  filter(avg_temp_ch3 < 189.137) %>% 
  group_by(species) %>% 
  tally()

# 5th percentile
quantile(flamm.df.noNA$avg_temp_ch3, 0.05)
flamm.df %>%
  filter(avg_temp_ch3 < 177.5593) %>% 
  group_by(species) %>% 
  tally()

# 1st percentile
quantile(flamm.df.noNA$avg_temp_ch3, 0.01)
flamm.df %>%
  filter(avg_temp_ch3 < 161.414) %>% 
  group_by(species) %>% 
  tally()

# Density plot
flamm.df %>% 
  ggplot(aes(x = avg_temp_ch3)) +
    geom_density(fill = 'gray', alpha = 0.4) +
    geom_vline(alpha = 0.5, aes(xintercept =
                                quantile(flamm.df.noNA$avg_temp_ch3, 0.01))) +
    annotate('text', x = 161.414, y = 0.03, label = '1%') +
    geom_vline(alpha = 0.5, aes(xintercept =
                                quantile(flamm.df.noNA$avg_temp_ch3, 0.05))) +
    annotate('text', x = 177.5593, y = 0.03, label = '5%') +
    geom_vline(alpha = 0.5, aes(xintercept =
                                quantile(flamm.df.noNA$avg_temp_ch3, 0.075))) +
    annotate('text', x = 189.137, y = 0.03, label = '7.5%') +
    geom_vline(alpha = 0.5, aes(xintercept =
                                quantile(flamm.df.noNA$avg_temp_ch3, 0.1))) +
    annotate('text', x = 208.9253, y = 0.03, label = '10%') +
    theme_bw() +
    labs(x = "Avg. Temp. (Top Vent)", y = 'Density') +
    theme(axis.title = element_text(face = 'bold', size = 14),
          axis.text.x = element_text(size = 12, angle = 20),
          axis.text.y = element_text(size = 12),
          legend.title = element_text(face = 'bold', size = 14),
          legend.text = element_text(size = 12))
```


# Summaries
## Temperature
Here are the various ways we've quantified temperature above:
- Maximum Temperature (in between ignition and flame end)
- Starting Temperature
- Temperature Change (max temp. (as above) - starting temp.)
- Average Temperature (full test)
- Average Temperature ('stable'; from 15 seconds after start to 10 seconds before ignition)
- Max. Temp. (+/- 2 seconds of flame height)
- Max. Temp. (full duration of test)
- Preignition Temp. (1sec before ignition)
- Temperature Deviation (max. temp. - average temp.)
  - Max. temp. - preignition temp.
  - 12 ways to calculate this due to 2 avg temp. calculations (each with CH2 and CH6) and 3 max. temp. calculations; what is the best way(s)?
  
Other things to note:
- Six different thermocouplers; which one or ones make the most sense for us to use?
- Missing data for following dates: 

### Visualization
```{r}
# Data Wrangling
long.temp.df <- flamm.df %>% 
  mutate(max_temp = as.numeric(max_temp), start_temp = as.numeric(start_temp), temp_change = as.numeric(temp_change)) %>% 
  select(species, fh, fd, ignition, max_temp, temp_change, start_temp, avg_temp_ch2, avg_temp_ch6, avg_stable_temp_ch2, avg_stable_temp_ch6, max_temp_flameht, max_temp_full_time) %>% 
  pivot_longer(cols = !c(species, fh, fd, ignition), names_to = 'temp_var', values_to = 'temp_vals') %>% 
  filter(temp_vals > 0)

# Facet Labels
temp_labels <- c('Maximum Temperature (FD)', 'Temperature Change', 'Starting Temperature', 'Average Temperature (CH2)', 'Average Temperature (CH6)', 'Avg. Temp. (Stable, CH2)', 'Avg. Temp. (Stable, CH6)', 'Maximum Temperature (FH +/- 2s)', 'Maximum Temperature (Full Test)')
names(temp_labels) <- c('max_temp', 'temp_change', 'start_temp', 'avg_temp_ch2', 'avg_temp_ch6', 'avg_stable_temp_ch2', 'avg_stable_temp_ch6', 'max_temp_flameht', 'max_temp_full_time')

# Scatterplots
## FH, split by species 
long.temp.df %>% 
  ggplot(aes(x = fh, y = temp_vals, color = species)) +
    geom_point(alpha = 0.7) +
    geom_smooth(se = F, method = 'lm') +
    facet_wrap(~temp_var, labeller = labeller(temp_var = temp_labels), scales = 'free_y') +
    labs(x = 'Flame Height', y = 'Temperature Variable', color = 'Species') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))
## FH, all species
long.temp.df %>% 
  ggplot(aes(x = fh, y = temp_vals)) +
    geom_point(alpha = 0.7) +
    geom_smooth(color = 'gray35') +
    facet_wrap(~temp_var, labeller = labeller(temp_var = temp_labels), scales = 'free_y') +
    labs(x = 'Flame Height', y = 'Temperature Variable') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))

## FD, split by species 
long.temp.df %>% 
  ggplot(aes(x = fd, y = temp_vals, color = species)) +
    geom_point(alpha = 0.7) +
    geom_smooth(se = F, method = 'lm') +
    facet_wrap(~temp_var, labeller = labeller(temp_var = temp_labels), scales = 'free_y') +
    labs(x = 'Flame Duration', y = 'Temperature Variable', color = 'Species') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))
## FD, all species
long.temp.df %>% 
  ggplot(aes(x = fd, y = temp_vals)) +
    geom_point(alpha = 0.7) +
    geom_smooth(color = 'gray35') +
    facet_wrap(~temp_var, labeller = labeller(temp_var = temp_labels), scales = 'free_y') +
    labs(x = 'Flame Duration', y = 'Temperature Variable') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))

# Density Plots
long.temp.df %>% 
  filter(temp_var %in% c('max_temp', 'temp_change', 'max_temp_flameht', 'max_temp_full_time')) %>% 
  ggplot(aes(x = temp_vals)) +
    geom_density(fill = 'gray35') +
    facet_wrap(~temp_var, labeller = labeller(temp_var = temp_labels), ncol = 1) +
    labs(y = 'Density', x = ' ') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))

# Boxplots
long.temp.df %>% 
  filter(temp_var %in% c('max_temp', 'temp_change', 'max_temp_flameht', 'max_temp_full_time')) %>% 
  ggplot(aes(y = temp_vals, x = species, color = species)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.1, height = 0.001, alpha = 0.5) +
    facet_wrap(~temp_var, labeller = labeller(temp_var = temp_labels), ncol = 1, scales = 'free_y') +
    labs(y = 'Temperature Variable', x = ' ') +
    theme_bw() +
    theme(legend.position = 'none',
        axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))

long.temp.df %>% 
  filter(temp_var %in% c('max_temp', 'temp_change', 'max_temp_flameht', 'max_temp_full_time')) %>% 
  ggplot(aes(y = temp_vals, x = ignition, color = ignition)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.1, height = 0.001, alpha = 0.5) +
    facet_wrap(~temp_var, labeller = labeller(temp_var = temp_labels), ncol = 1, scales = 'free_y') +
    labs(y = 'Temperature Variable', x = 'Ignition') +
    theme_bw() +
    theme(legend.position = 'none',
        axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))
```

## Heat Flux
Here are the ways we've quantified heat flux above:
- Maximum Heat Flux (raw data)
- Maximum Heat Flux (Loess regressions, with spans determined by optimization routine; for both CH7 and CH8)
- Average Heat Flux (during flaming combustion, CH8 only)
- Average Heat Flux (full test, CH8 only)
- Average Heat Flux ('stable'; from 15 seconds after start to 10 seconds before ignition; for both CH7 and CH8)
- Heat Flux Deviation from 'stable' average (for both CH7 and CH8; using max. heat flux calculated w/ Loess regressions)
- 95% percentile (as suggested by Max)
- Preignition heat flux (Loess regressed, CH7 and CH8)
- Max heat flux - preignition heat flux

### Visualization
```{r}
# Data Wrangling
long.heatflux.df <- flamm.df %>% 
  select(species, fh, fd, ignition, max_heat_flux, max_heat_flux_loessCH7, max_heat_flux_loessCH8, avg_heat_flux_fd, avg_heat_flux_full_test, avg_heat_flux_stableCH7, avg_heat_flux_stableCH8, heat_flux_deviationCH7, heat_flux_deviationCH8, heat_flux_95perc) %>% 
  pivot_longer(cols = !c(species, fh, fd, ignition), names_to = 'hf_var', values_to = 'hf_vals') %>% 
  filter(hf_vals > 0)

# Facet Labels
hf_labels <- c('Maximum Heat Flux', 'Maximum Heat Flux (Loess, CH7)', 'Maximum Heat Flux (Loess, CH8)', 'Average Heat Flux (FD)', 'Average Heat Flux (Full Test)', 'Average Heat Flux (Stable, CH7)', 'Average Heat Flux (Stable, CH8)', 'Heat Flux Deviation (From Stable Average, CH7)', 'Heat Flux Deviation (From Stable Average, CH8)', '95th Percentile Heat Flux')
names(hf_labels) <- c('max_heat_flux', 'max_heat_flux_loessCH7', 'max_heat_flux_loessCH8', 'avg_heat_flux_fd', 'avg_heat_flux_full_test', 'avg_heat_flux_stableCH7', 'avg_heat_flux_stableCH8', 'heat_flux_deviationCH7', 'heat_flux_deviationCH8', 'heat_flux_95perc')

# Scatterplots
## FH, split by species 
long.heatflux.df %>% 
  ggplot(aes(x = fh, y = hf_vals, color = species)) +
    geom_point(alpha = 0.7) +
    geom_smooth(se = F, method = 'lm') +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), scales = 'free_y') +
    labs(x = 'Flame Height', y = 'Heat Flux Variable', color = 'Species') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))
## FH, all species
long.heatflux.df %>% 
  ggplot(aes(x = fh, y = hf_vals)) +
    geom_point(alpha = 0.7) +
    geom_smooth(color = 'gray35') +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), scales = 'free_y') +
    labs(x = 'Flame Height', y = 'Heat Flux Variable') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))

## FD, split by species 
long.heatflux.df %>% 
  ggplot(aes(x = fd, y = hf_vals, color = species)) +
    geom_point(alpha = 0.7) +
    geom_smooth(se = F, method = 'lm') +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), scales = 'free_y') +
    labs(x = 'Flame Duration', y = 'Heat Flux Variable', color = 'Species') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))
## FD, all species
long.heatflux.df %>% 
  ggplot(aes(x = fd, y = hf_vals)) +
    geom_point(alpha = 0.7) +
    geom_smooth(color = 'gray35') +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), scales = 'free_y') +
    labs(x = 'Flame Duration', y = 'Heat Flux Variable') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))

# Density Plots
long.heatflux.df %>% 
  filter(hf_var %in% c('max_heat_flux', 'max_heat_flux_loessCH7', 'max_heat_flux_loessCH8', 'heat_flux_deviationCH7', 'heat_flux_deviationCH8', 'heat_flux_95perc')) %>% 
  ggplot(aes(x = hf_vals)) +
    geom_density(fill = 'gray35') +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), ncol = 2) +
    labs(y = 'Density', x = ' ') +
    theme_bw() +
    theme(axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        legend.title = element_text(face = 'bold', size = 16),
        legend.text = element_text(size = 14),
        axis.text.x = element_text(size = 12))

# Boxplots
## Vs. species
long.heatflux.df %>% 
  filter(hf_var %in% c('max_heat_flux', 'max_heat_flux_loessCH7', 'max_heat_flux_loessCH8', 'heat_flux_deviationCH7', 'heat_flux_deviationCH8', 'heat_flux_95perc')) %>% 
  ggplot(aes(y = hf_vals, x = species, color = species)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.1, height = 0.001, alpha = 0.5) +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), ncol = 2, scales = 'free_y') +
    labs(y = 'Heat Flux Variable', x = ' ') +
    theme_bw() +
    theme(legend.position = 'none',
        axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))

## Vs. ignition
long.heatflux.df %>% 
  filter(hf_var %in% c('max_heat_flux', 'max_heat_flux_loessCH7', 'max_heat_flux_loessCH8', 'heat_flux_95perc')) %>% 
  ggplot(aes(y = hf_vals, x = ignition, color = ignition)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.1, height = 0.001, alpha = 0.5) +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), ncol = 2, scales = 'free_y') +
    labs(y = 'Heat Flux Variable', x = 'Ignition') +
    theme_bw() +
    theme(legend.position = 'none',
        axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))

# Ridgeline
long.heatflux.df %>% 
  filter(hf_var %in% c('max_heat_flux', 'max_heat_flux_loessCH7', 'max_heat_flux_loessCH8', 'heat_flux_95perc')) %>% 
  ggplot(aes(y = hf_vals, x = ignition, color = ignition)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(width = 0.1, height = 0.001, alpha = 0.5) +
    facet_wrap(~hf_var, labeller = labeller(hf_var = hf_labels), ncol = 2, scales = 'free_y') +
    labs(y = 'Heat Flux Variable', x = 'Ignition') +
    theme_bw() +
    theme(legend.position = 'none',
        axis.title = element_text(face = 'bold', size = 16),
        axis.text = element_text(size = 14),
        axis.text.x = element_text(size = 12, angle = 20))
```
